---
title: "Assignment 1 - MA710 Bentley"
output: html_document
---

## 1. Introduction

The data we are working on is provided by the U.S department of Education. The data set contains information of College Scorecard, federal financial aid and students' earning records. The data set can help to understand the information of getting federal financial and have insights on the school performance as well as students' long term development. The data set contains 1743 variables which are organized into 10 categories. The categories cover a range of topics:

 * Root - basic information such as School Id and location.

 * School - basic descriptive information such as degree types, number of branches, Carnegie classification, Public or Private etc.

 * Academics - types of academics available at the school.

 * Admissions - admission statistics such as acceptance rate and SAT/ACT scores.

 * Student - descriptions of the students including the number of undergraduate students, part-time or full-time students, share of first generation students.

 * Cost - information  cost for students such as average cost of attendance, tuition and fees, and average net price for institutions by income level.

 * Aid - the amount of debt a student can take on while attending the college, typical monthly loan payments, and the percentage of Pell Grant Recipients.

 * Repayment - descriptions of how successful students are at repaying their debts which is measured by cohort default rate and repayment rate.

 * Completion - information on the completion and retention rates for first time and full time students.

 * Earnings - statistics on average and median earnings as well as share of former students' earning more than $25,000. 


Based on the information provided by the data set,the descriptive analysis is performed. 


## 2.Goals
"Private colleges vs. public colleges". There is a face-off that is been ongoing for many years. The major difference between public and private colleges lies in how they are funded. Public colleges are funded mostly by state governments, whereas private colleges rely heavily on private contributions, donations and tuition. The goal of our analysis is to compare public institutions and private colleges in terms of their "performance".  A college degree or post-secondary certificate is more important than ever. However, many students are not confident enough to making decision on the type of school they should choose. Our analysis aims at helping students understand the differences between public institutions and private colleges in terms of school size, school performance, tuition cost, degrees awarded, students' background and geographic information. The analysis should give potential students a brief overview of these two types of schools. 


## 3.DataSet Description

There are 26 variables that we are interested in. The variables name,  type and descriptions are listed below. 

*For variable `NPT4_PRIV` and `NPT4_PUB`, they includes tuition, supplies, living expenses minus the average grand or scholarship; the cost is calculated for full-time, fist-time, degree and certificate seeking undergraduates

*For variable `CCBASIC`, the Carnegie Classification describes the colleges as either Associate's college Special focus, Baccalaureate/Associate, Doctoral University, or Tribal college. 


|Variables        |Type     |Descriptions|
|-----------------|---------|-------------------------------
|Type             |FACTOR     |Public or Private Institution|
|State            |FACTOR     |State|
|Family_Inc       |NUMERIC    |Average family income in real 2015 dollars ($)|
|Female           |NUMERIC    |Percentage of female students|
|Married          |NUMERIC    |Percentage of married students|
|Ind_Per          |NUMERIC    |Percentage of financially independent students|
|First_Gen        |NUMERIC    |Percentage of first generation students|
|Degree           |FACTOR     |Predominant degree awarded |
|HIGHDEG          |FACTOR     |Highest degree awarded (0-non degree awarded;4-graduate degree)|
|REGION           |FACTOR     |The region where the college is located (10 levels)|
|NPT4_PRIV        |NUMERIC    |Average annual cost of attendance a Private college ($)|
|NPT4_PUB         |NUMERIC    |Average annual cost of attendance a Public college ($)|
|NUMBRANCH        |NUMERIC    |Number of Branch Campuses|
|CCBASIC          |INTEGER    |Carnegie Classification which describes the colleges|
|PCIP01           |NUMERIC    |Percentage of degrees awarded in Agriculture , Agriculture Operations, And Related Sciences|
|PCIP03           |NUMERIC    |Percentage of degrees awarded in Natural Resources And Conservation|
|PCIP04           |NUMERIC    |Percentage of degrees awarded in Architecture And Related Services|
|PCIP05           |NUMERIC    |Percentage of degrees awarded in Area, Ethnic, Cultural, Gender, And Group Studies|
|PCIP09           |NUMERIC    |Percentage of degrees awarded in Communication, Journalism, And Related Programs|
|PCIP10           |NUMERIC    |Percentage of degrees awarded in Communications Technologies/Technicians And Support Services|
|CDR3             |NUMERIC    |Three-year cohort default rate|
|CDR3_DENOM       |NUMERIC    |Number of students in the cohort for the three-year cohort default rate|
|PCTPELL          |NUMERIC    |Percentage of undergraduates who receive a Pell Grant|
|PCTFLOAN         |NUMERIC    |Percent of all federal undergraduate students receiving a federal student loan|
|DEBT_N           |NUMERIC    |The number of students in the median debt completers cohort|
|CUML_DEBT_N      |NUMERIC    |Number of students in the cumulative loan debt cohort|



## 4.Objectives

Our main goal of the project is to compare public and private schools. Based on this goal, we will define a number of objectives:

* Investigate whether public or private colleges are more common in some regions 
* Compare Private and Public colleges on the level of the degrees they offer
* Investigate whether public or private colleges tend to have higher number of campuses
* Find out how the tuition differs between the two type of colleges
* Use selected variables to explore whether public colleges and private ones are really different from repayment, aid and earnings perspective
* Understand how the percentage of degree awarded between public school and private school. The `gglot` and `dplyr` function to calculate mean, median, and variance are conducted. This can help students understand how those degrees are awarded between public schools and private schools and give them basic insights on making decisions. 




## 5.Data Preparation

In order to understand better the differences between private colleges and public institutions, we will conduct a descriptive statistical analysis.

### 5.1 Loading libraries

We will load the `dplyr` package that contains functions for data manipulation using data frames. It allows us to order rows, select rows, select variables, modify variables and summarize variables. We will also load the `ggplot2` package which is a powerful plotting package that creates elegant and complex plots in R. The `magrittr` library is loaded for the piping operator `%>%`. The `readr` library is loaded to read in the csv file.

```{r,message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(magrittr)
library(readr)
```

Then we read in the csv file `MERGED2014_15_PP.csv` into the data frame `csb.df` using the `read_csv` function of the `readr` package.

```{r,message=FALSE, warning=FALSE}
csb.df = read_csv(paste0('C:/Users/Chengdong Liang/Desktop/MA 710/Assignment 1/CollegeScorecard_Raw_Data/', 'MERGED2014_15_PP.csv'))

```
### 5.3 Data cleaning and variable modification

For our analysis, we wish to include only those institutions which are currently operating. So we filter the rows to keep those which have `CURROPER` equal to 1.

```{r,message=FALSE, warning=FALSE}
csb.df %>%
  filter(CURROPER ==1) %>%
  {.} -> csbop.df
```
The new data frame `csbop.df` consists of only currently operating institutions.
Based on our decision to select certain variables, we will use the `SELECT` command from `dply` package to create a smaller data frame which contains only the variables of interest.

```{r,message=FALSE, warning=FALSE}
csbop.df %>%
  select(CONTROL, ST_FIPS, FAMINC, FEMALE, MARRIED,DEP_STAT_PCT_IND, FIRST_GEN, PREDDEG, CDR3, CDR3_DENOM,
         PCTPELL, PCTFLOAN, DEBT_N, CUML_DEBT_N, OPEID, HIGHDEG, REGION, NPT4_PRIV, NPT4_PUB, NUMBRANCH, CCBASIC,
         PCIP01,PCIP03,PCIP04,PCIP05,PCIP09,PCIP10) %>%
  {.} -> csb.vars.df
```
The resulting data frame `csb.vars.df` contains only the selected variables. Next we get a glimpse of this new data frame `csb.vars.df`. The `glimpse` function allows us to see all the columns in the data frame.

```{r,message=FALSE, warning=FALSE}
glimpse(csb.vars.df)
```

The output tells us that the data frame `csb.vars.df` has 6893 observations and 27 variables. It also displays the class of these variables.We can see that some of the variables do no belong to the correct class. For instance, `CONTROL`(Type of institution - Public or Private) should be a factor variable, but it is an integer in the data frame. Similarly FEMALE (Percentage of female students) should be an integer, and not a character variable.

To convert the class of these variables to the desired class, we use the functions `as.numeric` and `as.factor`, which convert the class variables to `numeric` and `factor` respectively.The code below uses the `MUTATE` command from the `dplyr` library to alter variables of the input data frame `csb.vars.df` and returns the modified data frame `csb.class.df`. 

```{r,message=FALSE, warning=FALSE}
csb.vars.df %>% 
  mutate(FAMINC  = as.numeric(FAMINC),
         FEMALE = as.numeric(FEMALE), 
         MARRIED  = as.numeric(MARRIED),
         DEP_STAT_PCT_IND = as.numeric(DEP_STAT_PCT_IND),
         FIRST_GEN = as.numeric(FIRST_GEN),
         CONTROL    = as.factor(CONTROL),
         ST_FIPS = as.factor(ST_FIPS),
         PREDDEG = as.factor(PREDDEG),
         CDR3 = as.numeric(CDR3), 
         CDR3_DENOM  = as.numeric(CDR3_DENOM),
         PCTPELL = as.numeric(PCTPELL),
         PCTFLOAN = as.numeric(PCTFLOAN),
         DEBT_N = as.numeric(DEBT_N),
         CUML_DEBT_N = as.numeric(CUML_DEBT_N),
         OPEID = as.numeric(OPEID),
         NPT4_PRIV = as.numeric(NPT4_PRIV), 
         NPT4_PUB  = as.numeric(NPT4_PUB),
         PCIP01=as.numeric(PCIP01),
         PCIP03=as.numeric(PCIP03),
         PCIP04=as.numeric(PCIP04),
         PCIP05=as.numeric(PCIP05),
         PCIP09=as.numeric(PCIP09),
         PCIP10=as.numeric(PCIP10)) %>%
         {.} -> csb.class.df
```

The next step is to check for the percentage of NA (missing) values for the above range of variables. This is accomplished by first adding the number of NA values for each variable, dividing it by the `length` of the variable(total number of observations) and multiplying by 100 to convert it into percentage. 

Since we would like to apply this function to a range of variables, we use `summarise_at` command. `summarise_at` takes the set of columns to be summarized as the first parameter which in our case wold be all columns and the function to be applied to them as the second parameter.

```{r,message=FALSE, warning=FALSE}
csb.class.df %>% 
  summarise_at(.cols = vars(),
               .funs = function(x) sum(is.na(x))/length(x))*100
```

We can observe from the output that `FAMINC` has 4.16% missing values, `MARRIED` has 15.32% missing values and so on. Then we decide to include only those variables which have less than 20% missing values. This is done by using the `SELECT` command.

```{r}
csb.class.df %>%
  select(CONTROL, ST_FIPS, FAMINC, FEMALE, MARRIED,DEP_STAT_PCT_IND, FIRST_GEN, PREDDEG, 
         OPEID, HIGHDEG, REGION, NPT4_PRIV, NPT4_PUB, NUMBRANCH, CCBASIC, CDR3, CDR3_DENOM, PCTPELL, 
         PCTFLOAN, DEBT_N, CUML_DEBT_N, PCIP01,PCIP03,PCIP04,PCIP05,PCIP09,PCIP10 ) %>% 
         {.} -> csb.var.df
```

The selected variables are then put into a new data frame `csb.var.df`. 

As the goal of our project is to compare public and private institutions, we want to combine the two types of private institutions : private for-profit and private non-profit into one group called private institutions. We use the `ifelse` command to achieve this by assigning level 0 ( private) to those institutions with a value of 2 (private for-profit) or 3(private non-profit) and level 1 to public institutions. 

```{r,message=FALSE, warning=FALSE}

csb.var.df %>%
  mutate(CONTROL = ifelse((CONTROL==2|CONTROL==3),0,1)) %>%
  mutate(CONTROL    = as.factor(CONTROL)) %>%
  {.} ->csb.new.df
```

The data frame `csb.new.df` now contains the mutated variable `CONTROL` with only two levels - 0 for private institutions and 1 for public institutions.

The variables `NTP4_PRIV` and `NTP4_PUB` describes the average net price of either Public or Private colleges, and are complementing each other. For this reason, we will built a new variable `NPT4` which describes the average net price for both public and private colleges.

To do this, we first define a function `replace_na_values` which takes the variable as the input and by looping over the entire length of the variable, replaces each NA values by 0.  We call this function on our two variables `NPT4_PRIV` and `NPT4_PUB`. Then we create a new variable `NPT4` by adding the two variables `NPT4_PRIV` and `NPT4_PUB` using the `MUTATE` command.

```{r, cache=TRUE,message=FALSE, warning=FALSE}
  replace_na_values <- function (variable){
    for (i in 1:length(variable)){
      if (is.na(variable[i])){
        variable[i] = 0
      }
    }
    return (variable)
  }

csb.new.df %>% 
  mutate(NPT4 = replace_na_values(NPT4_PRIV) + replace_na_values(NPT4_PUB)) %>%
  {.} -> csb.new.df
```
Since the names of these variables are not easy to understand, we rename them using the `rename` function of the `dplyr` package.

```{r,message=FALSE, warning=FALSE}
csb.new.df %>%
  rename(Type = CONTROL,
         State = ST_FIPS,
         Family_Inc = FAMINC,
         Female = FEMALE,
         Married = MARRIED,
         Ind_Per = DEP_STAT_PCT_IND,
         First_Gen = FIRST_GEN,
         Degree = PREDDEG) %>%
         {.} -> csb.ren.df
```
The data frame `csb.ren.df` contains our final set of variables, ready for further analysis.

## 6.Variable Summaries

### 6.1 Degree and type

The following code is used to summarize the factor variable `Degree` using aggregates. We first group the institutions by their type and count the total number of institutions providing predominantly Certificate, Associate, Bachelor and Graduate degrees. The code used is:
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>% 
  group_by(Type) %>%
  summarise(Certificate=sum(Degree==1),
            Associate=sum(Degree==2),
            Bachelor=sum(Degree==3),
            Graduate=sum(Degree==4))
```

The output tells us that there are 2302 private institutions providing predominantly Certificate degree, 532 private institutions providing predominantly Associate degree, 1469 private institutions providing predominantly Bachelor degree and 269 private institutions providing predominantly Graduate degree.

Similarly the figures for public institutions are 602 providing predominantly Certificate degree, 766 providing predominantly Associate degree, 590 providing predominantly Bachelor degree and 16 private institutions providing predominantly Graduate degree. The largest share (2302 institutions) is that of private institutions providing predominantly Certificate degree.

### 6.2 Student demographics variables

The summary statistics for all the numeric variables were obtained using the `summarise_if` function. This function was used in combination with `is.numeric` to summarize only those variables which were numeric. We also grouped these variables by their `Type` which is Public or Private, before summarizing.The descriptive measures chosen were mean, median and variance. The `options` command was used to set the column width to infinity in order to see all the columns.

```{r,message=FALSE, warning=FALSE}
options(dplyr.width=Inf)
csb.ren.df %>% 
  select(Type, State, Family_Inc, Female, Married, Ind_Per, First_Gen) %>%
  group_by (Type) %>%
  summarise_if(is.numeric, funs(mean, median), na.rm=TRUE)
```

We can observe how these measures vary considerably for public and private institutions.Though the average family income for both type of institutions is roughly similar, the median family income for Public institutions ($ 31,000) is ~$3,000 more than that of Private institutions ($28,000). This is an interesting finding as private institutions being more expensive, should be expected to be attended by students coming from the higher income bracket. It can also be seen that private institutions have a larger average share of female students, married students, financially independent and first-generation students.

### 6.3 Aid variables

The code below is used to summarize the variables related to aid in the data set. These variables are Percentage of undergraduates who receive a Pell Grant, percent of all federal undergraduate students receiving a federal student loan, three-year cohort default rate, number of students in the cohort for the three-year cohort default rate, number of students in the median debt completers cohort and number of students in the cumulative loan debt cohort.

```{r,message=FALSE, warning=FALSE}
options(dplyr.width=Inf)
csb.ren.df %>% 
  select(Type, CDR3, CDR3_DENOM, PCTPELL, PCTFLOAN, DEBT_N, CUML_DEBT_N) %>%
  group_by (Type) %>%
  summarise_if(is.numeric, funs(mean, median, var), na.rm=TRUE)
```

From the output, we could summarize that private institutions have a much higher mean and median value for the percentage of undergraduates who receive a Pell Grant, who receive a Federal loan, and number of students in the cumulative loan debt cohort.

In terms of variance, variables denoting percentage of undergraduates who receive a Pell Grant, the number of students in the median debt completers cohort, number of students in the cumulative loan debt cohort and number of students in the cohort for the three-year cohort default rate are higher for Private institutions.

Thus we can see that the summary statistics reveals that considerable difference exists between Public and Private institutions.

### 6.4 Academics variables

Finally we summarized the variables in the academics category.The variables chosen were the percentage of degrees awarded in 
1) Agriculture , Agriculture Operations, And Related Sciences 
2) Natural Resources And Conservation
3) Architecture And Related Services 
4) Area, Ethnic, Cultural, Gender, And Group Studies 
5) Communication, Journalism, And Related Programs.

```{r,message=FALSE, warning=FALSE}
options(dplyr.width=Inf)
csb.vars.df %>% 
  group_by (CONTROL) %>%
  summarise_if(is.numeric, funs(mean, median, var), na.rm=TRUE)
```
The result indicated that the averages of the percentage of awarded degree in those 6 fields are less than 1% .Among those 6 awarded degree, the mean of the PCIP09 is the largest regardless of the control type.This result indicates that among those 6 variables, percentages of degrees awarded in Communication are awarded more than other degree.The variance of those 6 variables are relatively small, which means that from 2014 to 2015,the percentage of those 6 awarded degrees are almost the same in general. It does not vary to much in different institutes.PCIP01,PCIP03,PCIP05,PCIP09 degrees are awarded more in public school than private school. 


## 7.Variable relationship


In this section we will focus on comparing the Public vs Private colleges based on a number of characteristics that describes the colleges such as the cost of attendance, income level of students, loan information and repayment rates,gender, degrees.

First we will look at the total number of Public and Private colleges.

```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot  (aes(x   = as.factor(Type))) +
  geom_bar(aes(fill=Type)) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

From the graph above we can see that there are approximately 2,000 Public colleges in the data set we are exploring. The number of Private colleges is more than twice the number of Public colleges.That means that we will have more data available for Private colleges and we will be able to draw more conclusion for them based on the data set.


The Region variable gives information which region a college belongs to. The graph below shows the distribution of colleges by region.

```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(REGION))) +
  geom_bar(aes(fill= as.factor(Type))) +
  scale_fill_discrete(name="Type", labels= c("Private", "Public")) +
  labs(x="Region")
```

Based on the graph, we can observe that the colleges are not equally distributed among regions. Some regions such as numbers 2(Mid East),3(Great Lakes) and 5(Southeast) have much  larger amount of colleges compared to 7(Rocky Mountains) and 9(Outlying areas). In addition the ratio of the Public vs Private colleges changes between regions.Regions such as 9(outlying areas) has relatively high Private vs Public ratio while other regions such as 5(Southeast) have more balanced representation of both Public and Private colleges.

The variable `CCBASIC` describes the Carnegie classification of colleges. There are 33 different type of colleges ranging between Associate's college and Doctoral Universities. We will explore the distribution of colleges based on the CCBASIC values.

```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(CCBASIC))) +
  geom_bar(aes(fill= as.factor(Type)),
            position='dodge') +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="CCBASIC")
```

From the plot, we can see that some categories are stronger represented. A significant amount of the values belong to category (-2) which means that the classification is not applicable. In addition we can see that Public colleges are represented better in some categories(1,2,3,4,5) while private colleges are strongly represented in other categories such as 21,22,23. In order to be able to explore the graph in more details, we will remove the not classified colleges and will split the rest of the data in two parts - categories which are strongly represented by Public colleges and these which are strongly represented by Private colleges. In order to achieve the sub setting we will use the filter function from the `dplyr` package.


```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>% 
  filter(CCBASIC %in% c(1:9, 14:18)) %>%
  {.} -> csb.ren.pub.ccbasic.df

csb.ren.df %>% 
  filter(CCBASIC %in% c(10:13, 19:33)) %>%
  {.} -> csb.ren.priv.ccbasic.df

csb.ren.pub.ccbasic.df %>%
  ggplot(aes(x=as.factor(CCBASIC))) +
  geom_bar(aes(fill= as.factor(Type)),
            position='dodge') +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="CCBASIC")

csb.ren.priv.ccbasic.df %>%
  ggplot(aes(x=as.factor(CCBASIC))) +
  geom_bar(aes(fill= as.factor(Type)),
            position='dodge') +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="CCBASIC")
```

Based on the output, we can see that 9 (Associate's Colleges: High Vocational & Technical-High Nontraditional) and  14(Baccalaureate/Associate's Colleges: Associate's Dominant) are with almost equal numbers of Public and Private colleges. The rest of the categories are strongly dominated by one type or another. It's interesting to see that the majority of the Associates' colleges are mostly Public with very few Private options. On the other hand the Special focus Two-Years and the Baccalaureate colleges are mostly Private ones.

The next variable to explore is the Number of Branches. Again we will see the distribution colored based on the Public vs Private options.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(NUMBRANCH))) +
  geom_bar(aes(fill= as.factor(Type)),
            position='dodge') +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="NUMBRANCH")
```

From the graph, it is visible that the Private colleges are the ones that offer more branches. The Public colleges rarely have more than 6 branches. The majority of the colleges are with only one branch.

The next variable in our exploratory analysis is the `HIGHDEG`. It describes the highest degree awarded at the college. There are 5 levels of degree described through the variable (0 - non-degree-granting, 1 - Certificate degree, 2 - Associate degree, 4 - Graduate degree).

```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(HIGHDEG))) +
  geom_bar(aes(fill= as.factor(Type)),
            position='dodge') +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="HIGHDEG")
```

From the graph we can see that categories 0 (no degree), 1(Certificate) and 3(Bachelors) are very strongly represented by Private colleges. The Public colleges are stronger in giving Associate degrees and Graduate degrees.

The last variable to explore is the Tuition(NPT4).


```{r, cache=TRUE,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(Type),
             y=NPT4)) + 
  geom_boxplot(aes(fill=Type))+
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="Type")
```


Based on the box plots, we can see that the Private colleges(on the left) are more expensive compared to Public with some very expensive private colleges presented as outliers on the plot. The median of the tuition for Public colleges is also lower than the median of the tuition for Private colleges. The cheaper Private colleges are with comparable tuition to the most expensive Public colleges.

Another variable relationship to focus on is whether there is a strong relationship between the tuition and the number of branches.

```{r,message=FALSE, warning=FALSE}
ggplot(data=csb.ren.df) + 
  aes(x=NPT4,
      y=NUMBRANCH) + 
  geom_point(size=1,
             alpha=0.2)
```

Based on the plot, we can see that there is no clear correlation. The majority of the points are at the bottom of the graph which is explained by the fact that most of the colleges has 1 branch only. We can see that some colleges with very high number of branches, which stands out on the top of the graph, are with medium tuition in the range of 20,000 - 25,000. And the most expensive colleges has 1 branch only. Therefore we can not find a clear correlation between tuition and number of branches.

The next relationship, we are interested in is to see how the tuition relates to region. The question we are exploring is whether some regions are more expensive than other.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(REGION), y=NPT4)) +
  geom_boxplot(aes(fill=as.factor(Type))) +
  scale_fill_discrete(name= "Type", labels= c("Private", "Public")) +
  labs(x="Region")
```

The graph represents the tuition by region and by Public vs Private colleges. We can see that the tuition for the Public colleges is in general lower for each of the 9th regions. We can also observe that most of the regions are with comparable tuition when we compare the Private colleges and the Public colleges separately. Region 1(New England) stands out as the most expensive region when it comes to both Public and Private. While region 9 (Outlying areas) stands out as the cheapest area for education. Region 5(Southeast) has some very expensive colleges which stands out as outliers.

The next comparison is between the Classification and the Tuition We are exploring whether the tuition varies by the type of college.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=CCBASIC, y=NPT4)) +
  geom_point(aes(color=Type))
```

As we already discovered in previous graphs, certain type of colleges such as Associates are more strongly represented by Public colleges. As a result their tuition is lower than the tuition of other categories which are strongly represented by Private colleges such as Special focus Two Year colleges.

It is also interesting to explore whether some regions tend to have colleges with more branches and how that is affected by Public vs Private classification.


```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=as.factor(REGION), y=NUMBRANCH)) +
  geom_point(aes(color=Type)) +
  xlab("REGION")
```

From the graph, we can see that the number of branches are approximately equally distributed between the regions. Region 1(New England) and Region 9 (Outlying areas) have colleges which are in general with slightly less number of branches. That could be explained by the geographical size of the regions. If the region is larger then it would make sense for the college to expand the number of branches in order to cover larger students' population.



As a next variable relationship in our analysis, we will focus on financial independence, first generation and family income. In order to visualize the relationship between the three numeric variables, family income, percentage of students who are financially independent and the percentage of first generation students, we use a tile graph. The x-axis represents the Financially independent students in percentage while the y-axis shows the percentage of first generation students. The color of the tile depicts the family income of students, white tiles for the low values and red for the high values of family income. The code used is :
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot +
  aes(x=Ind_Per, 
      y= First_Gen, 
      z= Family_Inc) +
  stat_summary2d(fun=mean) +
  scale_fill_gradient(low="white", 
                      high="red") 
```
It can be observed from the graph that the there is a strong positive correlation between first generation students and financially independent students. This implies that institutes that have a higher share of first generation students also seem to have a higher share of financially independent students. Another observation is that the red tiles are at the lower end of both axes, indicating that institutes with students coming from a background of higher family income tend to have lower percentage of both first generation and financially independent students. 


We now try to analyse the relationship between family income of students, degree provided by institutions and the type of the institution.Since it involved one numeric and two factor variables, we use a heat map.The x-axis represents the type, the y-axis denotes the degree and the color of the boxes stands for the average family income of students.The code used is:

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  group_by (Type, Degree) %>%
  summarize(avg.inc=mean(Family_Inc, na.rm = TRUE)) %>%
  ggplot   (aes(x=Type, y=Degree)) + 
  geom_tile(aes(fill=avg.inc)) 
```

This output clearly depicts that institutes with students having the highest average family income predominantly award Bachelors degree (Degree = 3). This is true for both public and private institutions. On the other hand, institutes that award Certificate degrees have students with the lowest family income. This could partly be explained by the high cost of the 4-year Bachelors program.


The code below is used to count the number of colleges in each state and arrange them from highest to lowest.
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  group_by(State) %>%
  summarise(Num_of_Public = sum(Type == 1),
            Num_of_Private = sum(Type == 0)) %>%
  arrange(desc(Num_of_Public+Num_of_Private)) %>%
  print (n=3)
```

From the output it can be seen that States 6,36 and 48 have the highest total number of colleges. These states are California, New York and Texas.For these top 3 states, we now would like to know which are the most popular degrees.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  filter(State %in% c(6,36,48)) %>%
  ggplot(aes(x=State)) + 
  geom_bar(aes(fill=Degree), 
           position='dodge') 
```

Certificate degrees seem to be the most popular in State 6 and 48 which are California and Texas. It is the second most popular degree after Bachelor's degree in New York. For these most popular certificate degrees, we wish to find the relationship between the type of institution, first generation students % and the family income of students.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  filter(State %in% c(6,48,36) & Degree ==1) %>%
  ggplot(aes(x=Family_Inc, y=First_Gen)) +
  geom_point(aes(color=Type, size=3, alpha= 0.2)) + 
  guides(size=FALSE)
```

We could observe a negative correlation exists between the family income of students and the percentage of first generation students. This tell us that for the most popular Certificate degrees in the most popular states California, New York and Texas, first generation students have lower family income. 


Positive linear correlation exists between variable DEBT_N(The number of students in the median debt completers cohort) and variable (Number of students in the cumulative loan debt cohort). A smooth line is drawn through the data points. We could fine that the smooth line is straight line, thus the positive linear correlation between these two variables are pretty strong. 
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=CUML_DEBT_N, y=DEBT_N)) + 
  geom_line(aes(color='red')) + 
  stat_smooth()
```

Similarity, we could find the positive linear correlation also exists between DEBT_N and CDR3_DENOM:
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=DEBT_N, y=CDR3_DENOM)) + 
  geom_line(aes(color='red')) + 
  stat_smooth()
```

In the same way, the positive linear correlation also exists between CUML_DEBT_N and CDR3_DENOM:
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=CUML_DEBT_N, y=CDR3_DENOM)) + 
  geom_line(aes(color='red')) + 
  stat_smooth()
```

Based on the plots, we could notice that inside of the variable group CUML_DEBT_N, CDR3_DENOM and DEBT_N, any two variables have a  strong positive linear correlation.

To evaluate the performance of public and private institution, We use box-plot:  

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=CDR3)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.6)  +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

Because boxes overlap with both medians, no difference can be claimed. Namely we cannot tell if there is a difference in Three-year cohort default rate between public and private institutions.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCTPELL)) + 
  geom_boxplot(aes(fill=Type))  +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

Because boxes overlap but not both medians, it is likely that the Percentage of undergraduates who receive a Pell Grant in private colleges is greater than the one of public institutes.
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCTFLOAN)) + 
  geom_boxplot(aes(fill=Type)) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

Because boxes overlap but not both medians, it is likely that the Percent of all federal undergraduate students receiving a federal student loan in private colleges is greater than the one of public institutes.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=DEBT_N)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 30000) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

Because boxes overlap with both medians, no difference can be claimed. Namely we cannot tell if there is a difference in The number of students in the median debt completers cohort between public and private institutions.


```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCIP01)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.6) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```
The result indicates that the major percentage of taking agriculture degree is less than 0.1 percent in private school and less than 0.2 percent in public school. There are more outlier in private school. 

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCIP03)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.7) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

The result indicates that the majority percentage of taking natural resource degree is less than 0.15 percent in public school and less than 0.1 percent in private school.There are more outliers in private school than in public school.In some private school, the natural degree is awarded more than other private school and public school.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCIP04)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.5) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

The result indicates that the majority percentage of taking Architecture degree is less than 0.07 percent in private and public school. Private school has higher Architecture degree percentage than public school.There are more outliers in private school.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
ggplot(aes(x=Type,
           y=PCIP05)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.5) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

The result indicates that the majority percentage of Ethnic degree in private school is less than 0.1 percent while it is less than 0.05 in public school. There more higher percentage of Ethnic degree awarded in public school because public school has more outlines.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCIP09)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.6) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

The result indicates that majority of percentage of communication/journal degree awarded is less than 0.025 in public school.Private school has more high percentage communication egress awarded and has more outliers.

```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  ggplot(aes(x=Type,
             y=PCIP10)) + 
  geom_boxplot(aes(fill=Type)) +
  ylim(0, 0.5) +
  scale_x_discrete(labels= c("Private", "Public")) +
  scale_fill_discrete(labels= c("Private", "Public")) +
  labs(x="Type")
```

The result indicates that the range of percentage of communication technology degree awarded in private school is larger than public school. Private school has higher percentage of communication technology degree awarded.The percentage of communication technology degree awarded is more spread in private school than in public school. 

### Logistic regression

The main objective of the project has been to compare the public and private colleges based on a number of criteria in order to determine what are the main differences between the two types of educational institutions. As a final step for the project, we will build a logistic regression which includes all our initially selected variables as independent variables and the Type variable (describing the college as either Public or Private) as a dependent variable. The logistic regression is built through the use of the `glm` function.


```{r,message=FALSE, warning=FALSE}
csb.ren.df$Type <- as.factor(csb.ren.df$Type)
levels(csb.ren.df$Type)
csb.df <-na.omit(csb.ren.df)
str(csb.df)
mylogit <- glm(Type ~ State + Family_Inc + Female + Married + Ind_Per + First_Gen + Degree + HIGHDEG + REGION + NPT4 + NUMBRANCH + CCBASIC + CDR3_DENOM + CDR3 + PCTPELL + PCTFLOAN + DEBT_N + CUML_DEBT_N + PCIP01 + PCIP03 + PCIP04 + PCIP05 + PCIP09 + PCIP10, data = csb.ren.df, family = "binomial")

summary(mylogit)

```

Based on the regression, we can confirm the observations from the descriptive analysis in the previous sections of this report. From the regression report, we are interested in the variables which has coefficients different than 0 with 95% confidence. These variables are: State, Female (Percentage of female students), Ind_Per (Percentage of financially independent students), First_Gen (Percentage of first generation students), HIGHDEG (Highest degree awarded 0-non degree awarded;4-graduate degree), NPT4 (Tuition), NUMBRANCH (Number of branches), CCBASIC (Carnegie Classification which describes the colleges), CDR3_DENOM (Number of students in the cohort for the three-year cohort default rate), CDR3 (Three-year cohort default rate), PCTFLOAN (Percent of all federal undergraduate students receiving a federal student loan), DEBT_N (The number of students in the median debt completers cohort), PCIP10 (Percentage of degree awarded in Communication|Technology), PCIP03 (Percentage of degree in Natural Resources and Conversation). The list of the above variables represents the characteristics that differentiate Public and Private college. Based on the results, we can confirm see that the public and private colleges differ by their financial characteristics such as Tuition and Percentage of financially independent students as well as the percent of federal loans for undergraduate students. The also differ by the type of education being offered (based on the Carnegie classification and on the type of degrees). To explore further the difference we will also construct a correlation matrix. 


#### Correlation Matrix
The correlation matrix is done among all the independent numeric variables. The code prepares all the numeric independent variables using as.numeric function. The correlation matrix function in `dplyr` is applied to get the correlation among independent variables. 
```{r,message=FALSE, warning=FALSE}
csb.ren.df %>%
  select(Type,Family_Inc, Female,Married,Ind_Per, First_Gen, CDR3, CDR3_DENOM,PCTPELL, PCTFLOAN, DEBT_N, CUML_DEBT_N, NPT4_PRIV, NPT4_PUB, PCIP01,PCIP03,PCIP04,PCIP05,PCIP09,PCIP10) %>%
  {.} -> csb.vars1.df
  
 csb.vars1.df%>%
  mutate(Type=as.numeric(Type),
         Family_Inc=as.numeric(Family_Inc), 
         Female=as.numeric(Female),
         Married=as.numeric(Married),
         Ind_Per=as.numeric(Ind_Per), 
         First_Gen=as.numeric(First_Gen), 
         CDR3=as.numeric(CDR3), 
         CDR3_DENOM=as.numeric(CDR3_DENOM),
         PCTPELL=as.numeric(PCTPELL), 
         PCTFLOAN=as.numeric(PCTFLOAN), 
         DEBT_N=as.numeric(DEBT_N), 
         CUML_DEBT_N=as.numeric(CUML_DEBT_N), 
         NPT4_PRIV=as.numeric(NPT4_PRIV),
         NPT4_PUB=as.numeric(NPT4_PUB),
         PCIP01=as.numeric(PCIP01),
         PCIP03=as.numeric(PCIP03),
         PCIP04=as.numeric(PCIP04),
         PCIP05=as.numeric(PCIP05),
         PCIP09=as.numeric(PCIP09),
         PCIP10=as.numeric(PCIP10))%>%
  {.}->csb.vars2.df
  
  cor_matrix<-csb.vars2.df %>%
  group_by(Type)%>%
  do(as.data.frame(cor(.[,-1],method="spearman",use="pairwise.complete.obs")))

cor_matrix1<- cor_matrix%>%
  data.frame(row=rep(colnames(.)[-1],n_groups(.)))
cor_matrix1
```

Among private school, `PCIP03` and `PCIP05` has some correlation, around 0.53.Among public school, `PCIP05` and `PCIP09` has some correlation around 0.46. The correlation of those two variables don't vary too much. Moreover, for both private and public school, variable `CDR3_DENOM` is highly correlated with `CUML_DEBT_N` (with 0.97 correlation coefficient) and `DEBT_N`(with 0.97 correlation coefficient). `Family Income` and `PCTFLOAN` is highly correlated as well in both private school and public school. Understanding the correlation among independent variables can help with selecting proper models in later steps. 

##Conclusion

Based on the exploratory analysis of the selected variables, we can say that there are some clear distinctions between Public and Private colleges. Public and Private colleges tends to offer different types of degrees among each based on the Carnegie Classification. Additionally, the degree concentration varies between the two types of colleges with higher number of Architectural and Communication technologies degrees offered at Private colleges compared to Public colleges and at the same time higher number of Ethic and Agricultural degrees offered at Public Colleges. The tuition is another major difference between Public and Private with higher tuition at Private colleges where we can also observe an extreme outliers indicating very expensive Private institutions. The tuition of the college doesn't affect the income level of the attending students with some very low income students attending Private schools and at the same time very high income students preferring to enroll at Public colleges. This could be explained by the higher level of federal and Pell grants which are given to students attending Private schools. Even though the private schools are more expensive compared to the Public colleges, students from lower-income households receive a variety of grants which allow them to afford the expensive intuitions. The income level does affect the degree that the students are enrolled in. Our analysis indicates that students with the highest income prefer strongly Bachelor degrees while students with lower income are usually enrolled at Associate degrees or Certificate programs which could be explained by the significantly higher costs for Bachelor degrees compared to the rest.Private and Public colleges are also not spread out evenly in different regions of the country. That may be explained by the differences in the income levels and differences in the type of education needed in different parts of the country.

Overall we can conclude that Private and Public colleges complement each other. They serve different needs of the population in terms of type of degrees and concentration offered as well as more affordability which comes as lower tuition for the Public colleges and more grants available for Private colleges.
